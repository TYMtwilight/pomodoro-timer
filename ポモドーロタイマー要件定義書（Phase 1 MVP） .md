# ポモドーロタイマー要件定義書（Phase 1: MVP）

---

## 1. プロジェクト概要

### 1.1 プロジェクト名

ポモドーロタイマーWebアプリケーション

### 1.2 目的

ポモドーロテクニックを用いた時間管理を支援し、作業時間の記録と可視化を行うWebアプリケーションを開発する。

### 1.3 対象ユーザー

- 作業時間を管理したい個人ユーザー
- ポモドーロテクニックを実践したいユーザー

---

## 2. 機能要件

### 2.1 ログイン状態による機能分類

| 機能 | 未ログイン | ログイン時 |
| --- | --- | --- |
| タイマー機能 | ○ | ○ |
| 設定機能（保存なし） | ○ | - |
| 設定機能（保存あり） | - | ○ |
| 作業項目管理 | - | ○ |
| 作業記録保存 | - | ○ |
| 作業記録閲覧 | - | ○ |

---

### 2.2 タイマー機能

### 2.2.1 タイマー表示

- 残り時間を MM:SS 形式で表示
- 現在のステータス表示（「作業中」「短い休憩」「長い休憩」）
- 実行中セッション数表示（例：「1/4ポモドーロ」）
- プログレスバーで進捗を視覚化

### 2.2.2 操作機能

- 開始 / 一時停止 / 再開
- リセット（初期状態に戻す）
- スキップ（次のフェーズへ移行）

### 2.2.3 自動切り替え

- 作業時間終了 → 休憩時間へ自動移行
- 短い休憩終了 → 次の作業時間へ自動移行
- 設定ポモドーロ数完了後 → 長い休憩へ自動移行
- 長い休憩終了 → セッションカウントリセット

### 2.2.4 通知機能

- タイマー終了時の音声通知
- ページタイトルに残り時間表示

### 2.2.5 記録連携（ログイン時のみ）

- 作業時間終了時に自動記録
- 中断時も経過時間を記録

---

### 2.3 設定機能

### 2.3.1 設定項目

| 項目 | デフォルト値 | 設定範囲 |
| --- | --- | --- |
| 作業時間 | 25分 | 1-90分 |
| 短い休憩 | 5分 | 1-30分 |
| 長い休憩 | 15分 | 1-60分 |
| 長い休憩までのポモドーロ数 | 4 | 2-8 |

### 2.3.2 設定の保存

- **未ログイン時**：保存なし（セッション中のみ有効）
- **ログイン時**：データベースに保存

### 2.3.3 制約

- タイマー実行中は設定変更不可
- 入力値のバリデーション実施

---

### 2.4 作業項目管理機能（ログイン時のみ）

### 2.4.1 登録

- 項目名（必須、1-100文字）
- バリデーション：空欄チェック

### 2.4.2 編集

- 項目名の変更
- 保存 / キャンセル機能

### 2.4.3 削除

- 削除前に確認ダイアログ表示
- 過去の作業記録は保持

### 2.4.4 選択

- ドロップダウンメニューで選択
- 「項目なし」での作業も可能

---

### 2.5 作業記録保存機能（ログイン時のみ）

### 2.5.1 記録内容

- 開始時刻
- 終了時刻
- 作業項目ID（nullableで「項目なし」の場合はnull）
- 作業時間（秒単位）

### 2.5.2 保存タイミング

- ポモドーロ（作業時間）完了時に自動保存
- 一時停止 → リセット時も経過時間を保存
- スキップボタン押下時も経過時間を保存

---

### 2.6 作業記録閲覧機能（ログイン時のみ）

### 2.6.1 本日の記録一覧

- 作業項目名（または「項目なし」）
- 開始時刻
- 作業時間（分単位）
- 新しい順に表示

### 2.6.2 本日のサマリー

- 総作業時間

---

### 2.7 ログイン機能

### 2.7.1 認証方式

- Google OAuth認証

### 2.7.2 取得情報

- 名前
- メールアドレス
- プロフィール画像（オプション）

### 2.7.3 機能

- ログイン / ログアウト
- セッション管理
- 自動ログイン（Remember me）

---

## 3. 非機能要件

### 3.1 パフォーマンス

- タイマーは秒単位で正確に動作
- 別タブでもバックグラウンド動作継続

### 3.2 ユーザビリティ

- レスポンシブデザイン（モバイル対応）
- 直感的なUI設計

### 3.3 セキュリティ

- HTTPS通信
- 認証トークンの安全な管理
- CSRF対策

---

## 4. 画面構成

### 4.1 メイン画面（タイマー画面）

```
┌──────────────────────────────── ─┐
│ ヘッダー（ログインボタン等）       │ 
├─────────────────────────────────┤
│                                 │
│     タイマー表示エリア           │
│     （残り時間・プログレスバー） │
│                                 │
├─────────────────────────────────┤
│ 作業項目選択（ログイン時のみ）   │
├─────────────────────────────────┤
│ コントロールボタン               │
│ （開始・停止・リセット・スキップ）│
├─────────────────────────────────┤
│ 本日の記録（ログイン時のみ）     │
└─────────────────────────────────┘

```

### 4.2 設定画面（モーダル）

- 各種時間設定フォーム
- 保存ボタン（ログイン時のみ）
- デフォルトに戻すボタン

### 4.3 作業項目管理画面（モーダル）

- 新規登録フォーム
- 項目一覧（編集・削除ボタン付き）

---

## 5. データモデル

### 5.1 ER図概要

```
Users ──< Tasks
  │
  └──< Settings
  └──< Records >── Tasks

```

### 5.2 テーブル定義

### Users

| カラム名 | 型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | string | PK | ユーザーID |
| email | string | unique, not null | メールアドレス |
| name | string | not null | ユーザー名 |
| profile_image | string | nullable | プロフィール画像URL |
| created_at | timestamp | not null | 作成日時 |
| updated_at | timestamp | not null | 更新日時 |

### Tasks

| カラム名 | 型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | string | PK | 作業項目ID |
| user_id | string | FK, not null | ユーザーID |
| name | string | not null | 項目名 |
| created_at | timestamp | not null | 作成日時 |
| updated_at | timestamp | not null | 更新日時 |
| deleted_at | timestamp | nullable | 削除日時（論理削除） |

### Settings

| カラム名 | 型 | 制約 | 説明 |
| --- | --- | --- | --- |
| user_id | string | PK, FK | ユーザーID |
| work_duration | integer | not null | 作業時間（分） |
| short_break | integer | not null | 短い休憩（分） |
| long_break | integer | not null | 長い休憩（分） |
| pomodoros_until_long_break | integer | not null | 長い休憩までの回数 |
| created_at | timestamp | not null | 作成日時 |
| updated_at | timestamp | not null | 更新日時 |

### Records

| カラム名 | 型 | 制約 | 説明 |
| --- | --- | --- | --- |
| id | string | PK | 記録ID |
| user_id | string | FK, not null | ユーザーID |
| task_id | string | FK, nullable | 作業項目ID |
| start_time | timestamp | not null | 開始時刻 |
| end_time | timestamp | not null | 終了時刻 |
| duration | integer | not null | 作業時間（秒） |
| created_at | timestamp | not null | 作成日時 |

---

### RDB図

![mermaid-diagram-1766499076116.png](mermaid-diagram-1766499076116.png)

### ディレクトリ構成

pomodoro-timer/
├── auth.ts                    # NextAuth設定（メイン）
├── auth.config.ts             # NextAuth設定（共有設定、オプション）
├── middleware.ts              # 認証ミドルウェア（オプション）
├── app/
│   ├── actions/              # Server Actions
│   │   ├── tasks.ts         # 作業項目のCRUD
│   │   ├── records.ts       # 作業記録の保存・取得
│   │   └── settings.ts      # 設定の保存・取得
│   ├── api/
│   │   └── auth/            # NextAuth.js専用（必須）
│   │       └── [...nextauth]/
│   │           └── route.ts
│   ├── (auth)/              # 認証関連ページ（オプション）
│   ├── (dashboard)/         # ダッシュボード（ログイン後）
│   ├── layout.tsx           # ルートレイアウト
│   ├── page.tsx             # トップページ（タイマー画面）
│   └── globals.css          # グローバルCSS
├── components/
│   ├── ui/                  # shadcn/ui コンポーネント
│   ├── timer/               # タイマー関連コンポーネント
│   ├── tasks/               # 作業項目関連コンポーネント
│   └── records/             # 記録関連コンポーネント
├── lib/
│   ├── prisma.ts            # Prisma Client
│   └── utils.ts             # ユーティリティ関数
├── prisma/
│   └── schema.prisma        # Prismaスキーマ
├── public/                  # 静的ファイル
├── types/                   # TypeScript型定義
├── .cursorrules             # Cursorプロジェクトルール
├── .env.local               # 環境変数（ローカル）
├── .gitignore
├── next.config.js           # Next.js設定
├── tailwind.config.ts       # Tailwind CSS設定
├── tsconfig.json            # TypeScript設定
└── package.json

## 6.技術スタック定義

### 1. フロントエンド

1.1 コアフレームワーク

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **Next.js** | 15.x (App Router) | フルスタックフレームワーク |
| **React** | 19.x | UIライブラリ |
| **TypeScript** | 5.x | 型システム |

1.2 UIライブラリ・スタイリング

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **shadcn/ui** | latest | UIコンポーネントライブラリ |
| **Tailwind CSS** | 3.x | ユーティリティファーストCSS |
| **lucide-react** | latest | アイコンライブラリ |

1.3 状態管理

- React標準機能を使用
    - `useState`
    - `useContext`
    - `useReducer`（必要に応じて）

1.4 バリデーション

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **zod** | 3.x | スキーマバリデーション |

1.5 日付・時刻操作

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **date-fns** | 3.x | 日付操作ライブラリ |

---

### 2. バックエンド

2.1 フレームワーク

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **Next.js Server Actions** | 15.x | サーバーサイドロジック（CRUD操作） |

2.2 認証

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **NextAuth.js (Auth.js)** | 5.x | 認証システム |
| **Google OAuth Provider** | - | Google認証プロバイダー |

2.3 データベース

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **PostgreSQL** | 15.x以上 | リレーショナルデータベース |
| **Supabase** | - | データベースホスティング |
| **Prisma** | 5.x | ORM（Object-Relational Mapping） |

---

### 3. 開発ツール

3.1 コード品質

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **ESLint** | 8.x | コードリンター |
| **Prettier** | 3.x | コードフォーマッター |
| **TypeScript ESLint** | 7.x | TypeScript用ESLintルール |

---

### 4. デプロイ・ホスティング

| サービス | 用途 |
| --- | --- |
| **Vercel** | アプリケーションホスティング（Next.js最適化） |
| **Supabase** | PostgreSQLデータベースホスティング |

### システム全体構成図

![image.png](image.png)

### Server Actionsエンドポイント構成

![image.png](image%201.png)

## 7. Phase 1で実装しない機能

- GitHubスタイルカレンダー表示
- グラフ化機能
- 週・月・年単位の記録閲覧
- ブラウザ通知（デスクトップ通知）
- カテゴリ・タグ機能
- 項目の色分け
- エクスポート機能
- 作業記録の編集・削除
- 作業項目の並び替え・検索
- 完了ポモドーロ数のカウント
- 集中度の指標

---

## 8. 制約事項・前提条件

### 8.1 ブラウザ対応

- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）

### 8.2 その他

- インターネット接続必須（ログイン機能利用時）
- JavaScript有効が前提

---

## 9. 成果物

- Webアプリケーション本体
- 技術ドキュメント
- ユーザーマニュアル（簡易版）

---

**文書バージョン**: 1.1

**作成日**: 2024年12月23日

**最終更新日**: 2024年12月23日

# 技術スタック定義

## 1. フロントエンド

### 1.1 コアフレームワーク

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **Next.js** | 15.x (App Router) | フルスタックフレームワーク |
| **React** | 19.x | UIライブラリ |
| **TypeScript** | 5.x | 型システム |

### 1.2 UIライブラリ・スタイリング

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **shadcn/ui** | latest | UIコンポーネントライブラリ |
| **Tailwind CSS** | 3.x | ユーティリティファーストCSS |
| **lucide-react** | latest | アイコンライブラリ |

### 1.3 状態管理

- React標準機能を使用
    - `useState`
    - `useContext`
    - `useReducer`（必要に応じて）

### 1.4 バリデーション

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **zod** | 3.x | スキーマバリデーション |

### 1.5 日付・時刻操作

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **date-fns** | 3.x | 日付操作ライブラリ |

---

## 2. バックエンド

### 2.1 フレームワーク

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **Next.js API Routes** | 15.x | RESTful API |
| **Next.js Server Actions** | 15.x | サーバーサイドロジック（オプション） |

### 2.2 認証

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **NextAuth.js (Auth.js)** | 5.x | 認証システム |
| **Google OAuth Provider** | - | Google認証プロバイダー |

### 2.3 データベース

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **PostgreSQL** | 15.x以上 | リレーショナルデータベース |
| **Supabase** | - | データベースホスティング |
| **Prisma** | 5.x | ORM（Object-Relational Mapping） |

---

## 3. 開発ツール

### 3.1 コード品質

| 技術 | バージョン | 用途 |
| --- | --- | --- |
| **ESLint** | 8.x | コードリンター |
| **Prettier** | 3.x | コードフォーマッター |
| **TypeScript ESLint** | 7.x | TypeScript用ESLintルール |

---

## 4. デプロイ・ホスティング

| サービス | 用途 |
| --- | --- |
| **Vercel** | アプリケーションホスティング（Next.js最適化） |
| **Supabase** | PostgreSQLデータベースホスティング |